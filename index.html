<!DOCTYPE html>
<HTML>
<HEAD>
	<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta name="Keywords" content="webMIDIAPI,WebMidiApi,webmidiapi">
	<script type="text/javascript" src="https://mikatahara.github.io/drawgraph.js"></script>
	<script type="text/javascript" src="https://mikatahara.github.io/mywebmidiapi.js"></script>
	<title>CTRL MON</title>

<style>
	#sans { color: #dddddd; font-family:sans-serif ; font-size: 10pt; line-height : 1.5em}
	#mono { color: #dddddd; font-family:monospace ; font-size: 10pt; line-height : 1.5em}

   #log {
		font-size: 10pt;
		width:29em;
		height:18.5em;
		margin:0.0em 8.0em .5em .5em;
		background-color:#222222;
		font-family:Courier New, monospace;
		overflow:auto;
    }

   #ctrlshape {
		font-size: 22pt;
		width:36em;
		height:10em;
		margin:.5em .5 .5em .5;
		background-color:#222222;
		font-family:Courier New, monospace;
		overflow:auto;
    }
</style>

</HEAD>
<body bgcolor="#222222" text="#dddddd" link="#0000ff" vlink="#ff00ff" 
alink="#ff0000" style="margin-right:28px;margin-left:28px;margin-top:10px;">
<br>
<center><h2>CONTROL CHANGE MONITOR<h2></center>
<!--	-------------------------------------------------------------------- -->
<div id="sans">
<table border="0">
<tr><td width="100"></td>
<td width="100"><b>Input Port:</b></td>
<td>
<form name="input_device_select">
<select name="ids" onChange="inputDeviceSelectLocal(this);">
<option value="0">No Device
</select>
</form>
</td>
<td width="20"></td>
<td width="190"><b>Cotrol Change Number:</b></td>
<td>
<form method="volume">
<input type="number" name="ctrl1"  step="1.0" min="0" max="127" value="1" onchange="rCtrl1Change(this.value);"> 
</form>
</tr>
</table>
<br>

<form name="output_device_select">
<!-- <select name="ids" onChange="outputDeviceSelect(this);">
//<option value="0">No Device
//</select> -->
</form>
</div>
<!--	------------------------------------------------------------------ -->
<center>
<canvas id="ctrlshape">
</canvas>
</center>
<br>
<div id="log">
</div>

<!--	-------------------------------------------------------------------- -->
<script>

	window.onload = function()
	{
		runTest();
		setInputMenuID(document.input_device_select.ids);
		setOutputMenuID(document.output_device_select.ids);

		var hoge = setInterval(function() {
		    //èIóπèåè
			if (input != null) {
			input.onmidimessage = handleMIDIMessageLocal;
			clearInterval(hoge);
			}
		}, 200);

	};

	const DSIZE=1024;
	const CTRL7=128;

	/* ï`âÊóÃàÊÇÃèâä˙âª */
	var fdg1 = new DrawGraph(0,1024,0,256);
	fdg1.fSetCanvas(document.getElementById('ctrlshape'));
	fdg1.fResize();
	fdg1.fFillColor("#ccccff");
	fdg1.fLine(0,0,fdg1.cv.width,fdg1.cv.height);
	fdg1.fLine(fdg1.cv.width,0,0,fdg1.cv.height);
	fdg1.fSetWindowXY(0,fdg1.cv.width,0,fdg1.cv.height);
	fdg1.fSetViewPort(0,DSIZE,0,CTRL7);
	fdg1.fStrokeRect();

	function handleMIDIMessageLocal( event )
	{
		if(event.data[0]==0xB0){
			mVal[event.data[1]]=event.data[2];
		}
	}

	function inputDeviceSelectLocal( item )
	{
		inputDeviceSelect( item );
		input.onmidimessage = handleMIDIMessageLocal;
	}

	var mCtrl=1;
	var mVal=Array(CTRL7);
	var mData=Array(4);
	for(var i=0; i<4; i++) mData[i]=Array(DSIZE);

	for(var i=0; i<4; i++){ for(j=0; j<DSIZE; j++) mData[i][j]=0; }
	for(var i=0; i<CTRL7; i++){ mVal[i]=0; }

	var hoge = setInterval(function() {
		for(i<0; i<4; i++){
			for(var j=0; j<DSIZE-j; j++){
				mData[i][DSIZE-1-i]=mData[i][DSIZE-2-i];
			}
		}
		mData[0][0]=mVal[mCtrl];
		fdg1.fClearWindowInside();
		fdg1.fDrawLine(mData[0]);
	}, 20);

	function rCtrl1Change( cnum )
	{
		mCtrl=cnum;
		for(var i=0; i<DSIZE; i++){ mData[i]=0; }
	}
</script>

</BODY>
<!-- ---------------------------------------------------------------------	-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-66117399-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- ---------------------------------------------------------------------	-->
</HTML>
